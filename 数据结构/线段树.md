# 线段树

维护区间信息。  

**要求：**  

1. 信息可划分：通常为下标或值域
2. 满足区间可加性：父节点的信息可由子节点合并而来

## 基本结构

是二叉树。

若下标区间的大小为 $n$，采用堆式储存的线段树需要 $4\cdot n$ 个节点。

若采用动态开点，需要 $2\cdot n$ 个节点。

每个节点维护一定的信息和懒标记。

## 题目

### AcWing 243. 一个简单的整数问题2

题意：区间加，区间求和。有负数。

维护 add 的懒标记，直接解决。

### AcWing 245. 你能回答这些问题吗

题意：单点加，区间查询最大连续子段和。

维护每个节点内区间和 sum，与最左、最右节点连续的最大和 lval / rval 和区间最大和 val。

可知，push up 时，lval / rval 由子节点的 lval / rval / sum 得出，
val 由 val / rval + lval 得出。

### AcWing 246. 区间最大公约数

题意：区间加，区间求 gcd

由更相减损术可知，$\gcd(a,b,c,d)=\gcd(a,b-a,c-b,d-c)$

故应维护差分，区间加变单点加

区间查 gcd 时，答案应取线段树查询 [l+1,r] 结果和区间头的数的 gcd

故应另外使用 BIT 维护数列

注意：\<cmath\> 中的 `abs()` 函数只支持 `int`，最好使用 `std::abs`

### AcWing 247. 亚特兰蒂斯

题意：求多个矩形的并的面积
